# 高并发应用1 提高效率

以调用方角度来讲，如果：

- 需要等待结果返回，才能继续运行就是同步
- 不需要等待结果返回，就能继续运行就是异步



### 设计

多线程可以让方法执行变为异步比如说读取磁盘文件时，假设读取操作花了5秒钟，如果没有线程调度机制，这5秒cpu什么都做不了



### 结论

- 比如项目中，视频文件需要转换格式等操作比较费时，这时开一个新线程处理视频转换，避免阻塞主线程
- tomcat的异步servlet也是类似的目的，让用户线程耗时较长的操作，避免阻塞tomcat的工作现场
- ui程序中，开线程进行其他操作，避免阻塞ui线程



## 案例一

充分利用多核cpu的优势，提高运行效率，想象下面的场景，执行3个计算，最后将计算结果汇总。

```
计算 1 花费 10ms
计算 2 花费 11ms
计算 3 花费 9ms
汇总需要 1ms
```

- 串行执行，花费总时间是 10 + 11 + 9 + 1 = 31 ms
- 如果是四核cpu，各个核心分别使用线程执行，则 11 + 1 = 12ms

> 注意：
>
> 需要在多核cpu才能提高效率，单核仍然是轮流执行



### 结论

1. 单核 cpu 下，多线程不能实际提高程序运行效率，只是为了能够在不同的任务之间切换，不同线程轮流使用cpu ，不至于一个线程总占用 cpu，别的线程没法干活
2. 多核 cpu 可以并行跑多个线程，但能否提高程序运行效率还是要分情况的
有些任务，经过精心设计，将任务拆分，并行执行，当然可以提高程序的运行效率。但不是所有计算任务都能拆分（参考后文的【阿姆达尔定律】）也不是所有任务都需要拆分，任务的目的如果不同，谈拆分和效率没啥意义
3. IO 操作不占用 cpu，只是我们一般拷贝文件使用的是【阻塞 IO】，这时相当于线程虽然不用 cpu，但需要一直等待 IO 结束，没能充分利用线程。所以才有后面的【非阻塞 IO】和【异步 IO】优化

